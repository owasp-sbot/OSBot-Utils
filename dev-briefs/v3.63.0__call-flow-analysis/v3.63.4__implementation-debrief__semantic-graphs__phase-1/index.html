<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://owasp-sbot.github.io/OSBot-Utils/dev-briefs/v3.63.0__call-flow-analysis/v3.63.4__implementation-debrief__semantic-graphs__phase-1/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>v3_64_1 Implementation Debrief: Semantic Graphs &amp; Code Structure - OSBot-Utils Documentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "v3_64_1 Implementation Debrief: Semantic Graphs \u0026amp; Code Structure";
        var mkdocs_page_input_path = "dev-briefs/v3.63.0__call-flow-analysis/v3.63.4__implementation-debrief__semantic-graphs__phase-1.md";
        var mkdocs_page_url = "/OSBot-Utils/dev-briefs/v3.63.0__call-flow-analysis/v3.63.4__implementation-debrief__semantic-graphs__phase-1/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> OSBot-Utils Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Code</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >OSBot Utils</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >Helpers</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../code/osbot_utils/helpers/flows/osbot-utils-flow-system-documentation/">Flows</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../dev/Python-code-formatting-guidelines/">Coding Guidelines</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Type Safety</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../../../dev/type_safe/python-type-safety-frameworks-compared.md">Frameworks Compared</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../dev/type_safe/type-safe-technical-documentation.md">Technical Documentation</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">OSBot-Utils Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">v3_64_1 Implementation Debrief: Semantic Graphs &amp; Code Structure</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="v3_64_1-implementation-debrief-semantic-graphs-code-structure">v3_64_1 Implementation Debrief: Semantic Graphs &amp; Code Structure<a class="headerlink" href="#v3_64_1-implementation-debrief-semantic-graphs-code-structure" title="Permanent link">&para;</a></h1>
<ul>
<li><strong>Version</strong>: v3.64.1</li>
<li><strong>Date</strong>: January 2026</li>
<li><strong>Implements</strong>: Brief 3 - Semantic Graphs &amp; Code Structure</li>
<li><strong>Status</strong>: Initial Implementation Complete, Refinements Identified</li>
</ul>
<hr />
<h2 id="executive-summary">Executive Summary<a class="headerlink" href="#executive-summary" title="Permanent link">&para;</a></h2>
<p>This debrief documents the implementation of the Semantic Graphs framework and Code Structure analyzer as specified in Brief 3. The implementation successfully created a generic graph-based ontology system with Python-specific application for code structure analysis. During integration into the codebase, a key refinement was identified regarding ID primitives.</p>
<p><strong>Implementation Statistics:</strong>
- <strong>Source Files</strong>: 42 Python files
- <strong>JSON Data Files</strong>: 3 ontology/taxonomy/rules definitions
- <strong>Test Files</strong>: 9 comprehensive test suites
- <strong>Total Test Methods</strong>: ~120 tests</p>
<hr />
<h2 id="part-1-what-was-implemented">Part 1: What Was Implemented<a class="headerlink" href="#part-1-what-was-implemented" title="Permanent link">&para;</a></h2>
<h3 id="11-semantic-graphs-framework">1.1 Semantic Graphs Framework<a class="headerlink" href="#11-semantic-graphs-framework" title="Permanent link">&para;</a></h3>
<p>The generic framework was implemented in <code>osbot_utils/helpers/semantic_graphs/</code> with four main subsystems:</p>
<h4 id="primitives-primitives">Primitives (<code>primitives/</code>)<a class="headerlink" href="#primitives-primitives" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Primitive</th>
<th>Purpose</th>
<th>Original Base</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Ontology_Id</code></td>
<td>Identifies ontology definitions</td>
<td><code>Safe_Id</code></td>
</tr>
<tr>
<td><code>Taxonomy_Id</code></td>
<td>Identifies taxonomy definitions</td>
<td><code>Safe_Id</code></td>
</tr>
<tr>
<td><code>Category_Id</code></td>
<td>Identifies taxonomy categories</td>
<td><code>Safe_Id</code></td>
</tr>
<tr>
<td><code>Node_Type_Id</code></td>
<td>Identifies node types in ontology</td>
<td><code>Safe_Id</code></td>
</tr>
<tr>
<td><code>Rule_Set_Id</code></td>
<td>Identifies rule set collections</td>
<td><code>Safe_Id</code></td>
</tr>
<tr>
<td><code>Safe_Str__Ontology__Verb</code></td>
<td>Relationship verbs (lowercase + underscores)</td>
<td><code>Safe_Str</code></td>
</tr>
</tbody>
</table>
<h4 id="ontology-ontology">Ontology (<code>ontology/</code>)<a class="headerlink" href="#ontology-ontology" title="Permanent link">&para;</a></h4>
<pre><code>ontology/
├── schemas/
│   ├── Schema__Ontology__Relationship.py    # inverse + targets
│   ├── Schema__Ontology__Node_Type.py       # description + relationships + taxonomy_ref
│   └── Schema__Ontology.py                  # Main container with validation methods
└── Ontology__Registry.py                    # JSON loading and caching
</code></pre>
<p><strong>Key Methods on Schema__Ontology:</strong>
- <code>valid_edge(source_type, verb, target_type)</code> → bool
- <code>get_inverse_verb(source_type, verb)</code> → str | None
- <code>edge_forward_name(...)</code> → str (e.g., "class_has_method")
- <code>edge_inverse_name(...)</code> → str (e.g., "method_in_class")
- <code>all_valid_edges()</code> → List[Tuple]
- <code>node_type_ids()</code> → List[str]
- <code>verbs_for_node_type(node_type_id)</code> → List[str]
- <code>targets_for_verb(node_type_id, verb)</code> → List[str]</p>
<h4 id="taxonomy-taxonomy">Taxonomy (<code>taxonomy/</code>)<a class="headerlink" href="#taxonomy-taxonomy" title="Permanent link">&para;</a></h4>
<pre><code>taxonomy/
├── schemas/
│   ├── Schema__Taxonomy__Category.py        # Hierarchical category
│   └── Schema__Taxonomy.py                  # Tree structure with navigation
└── Taxonomy__Registry.py                    # JSON loading and caching
</code></pre>
<p><strong>Key Methods on Schema__Taxonomy:</strong>
- <code>get_category(category_id)</code> → Category | None
- <code>get_root()</code> → Category | None
- <code>get_children(category_id)</code> → List[Category]
- <code>get_parent(category_id)</code> → Category | None
- <code>get_ancestors(category_id)</code> → List[Category]
- <code>get_descendants(category_id)</code> → List[Category]</p>
<h4 id="rules-rules">Rules (<code>rules/</code>)<a class="headerlink" href="#rules-rules" title="Permanent link">&para;</a></h4>
<pre><code>rules/
├── schemas/
│   ├── Schema__Rule__Transitivity.py        # A→B→C implies A→C
│   ├── Schema__Rule__Cardinality.py         # min/max constraints
│   └── Schema__Rule_Set.py                  # Collection with lookup methods
└── Rule__Engine.py                          # JSON loading and caching
</code></pre>
<p><strong>Key Methods on Schema__Rule_Set:</strong>
- <code>is_transitive(source_type, verb, target_type)</code> → bool
- <code>get_cardinality(source_type, verb, target_type)</code> → Rule | None</p>
<h4 id="graph-graph">Graph (<code>graph/</code>)<a class="headerlink" href="#graph-graph" title="Permanent link">&para;</a></h4>
<pre><code>graph/
├── schemas/
│   ├── Schema__Semantic_Graph__Node.py      # node_id, node_type, name, line_number
│   ├── Schema__Semantic_Graph__Edge.py      # edge_id, from_node, verb, to_node
│   └── Schema__Semantic_Graph.py            # Container with query methods
├── Semantic_Graph__Builder.py               # Fluent API for construction
└── Semantic_Graph__Validator.py             # Validates against ontology + rules
</code></pre>
<p><strong>Key Methods on Schema__Semantic_Graph:</strong>
- <code>add_node(node)</code> / <code>add_edge(edge)</code> → self (fluent)
- <code>get_node(node_id)</code> → Node | None
- <code>node_count()</code> / <code>edge_count()</code> → int
- <code>nodes_by_type(node_type)</code> → List[Node]
- <code>edges_from(node_id)</code> / <code>edges_to(node_id)</code> → List[Edge]
- <code>edges_by_verb(verb)</code> → List[Edge]
- <code>neighbors(node_id, verb=None)</code> → List[str]
- <code>reverse_neighbors(node_id, verb=None)</code> → List[str]</p>
<h3 id="12-python-domain-primitives">1.2 Python Domain Primitives<a class="headerlink" href="#12-python-domain-primitives" title="Permanent link">&para;</a></h3>
<p>Implemented in <code>osbot_utils/type_safe/primitives/domains/python/safe_str/</code>:</p>
<table>
<thead>
<tr>
<th>Primitive</th>
<th>Pattern</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Safe_Str__Python__Class</code></td>
<td><code>[a-zA-Z0-9_]</code></td>
<td>Class names (PascalCase)</td>
</tr>
<tr>
<td><code>Safe_Str__Python__Method</code></td>
<td><code>[a-zA-Z0-9_]</code></td>
<td>Methods (allows <code>__dunder__</code>)</td>
</tr>
<tr>
<td><code>Safe_Str__Python__Function</code></td>
<td><code>[a-zA-Z0-9_]</code></td>
<td>Function names</td>
</tr>
<tr>
<td><code>Safe_Str__Python__Package</code></td>
<td><code>[a-z0-9_]</code></td>
<td>Package names (lowercase)</td>
</tr>
<tr>
<td><code>Safe_Str__Python__Qualified_Name</code></td>
<td><code>[a-zA-Z0-9_.]</code></td>
<td>Full paths with dots</td>
</tr>
</tbody>
</table>
<h3 id="13-code-structure-analyzer">1.3 Code Structure Analyzer<a class="headerlink" href="#13-code-structure-analyzer" title="Permanent link">&para;</a></h3>
<p>Implemented in <code>osbot_utils/helpers/python_call_flow/code_structure/</code>:</p>
<pre><code>code_structure/
├── Code_Structure__Analyzer.py              # Main analyzer
├── __init__.py
└── data/
    ├── ontology__code_structure.json        # Node types and relationships
    ├── taxonomy__code_elements.json         # Classification hierarchy
    └── rules__python.json                   # Python-specific constraints
</code></pre>
<p><strong>Code_Structure__Analyzer Methods:</strong>
- <code>analyze(target)</code> → Schema__Semantic_Graph
- <code>analyze_module(module)</code> → Node_Id
- <code>analyze_class(cls)</code> → Node_Id
- <code>analyze_method(method, cls)</code> → Node_Id
- <code>analyze_function(func)</code> → Node_Id
- <code>lookup_node(qualified_name)</code> → Node_Id | None
- <code>qualified_name(target)</code> → str
- <code>get_line_number(target)</code> → int</p>
<h3 id="14-json-data-files">1.4 JSON Data Files<a class="headerlink" href="#14-json-data-files" title="Permanent link">&para;</a></h3>
<h4 id="ontology__code_structurejson">ontology__code_structure.json<a class="headerlink" href="#ontology__code_structurejson" title="Permanent link">&para;</a></h4>
<pre><code class="language-json">{
  &quot;ontology_id&quot;: &quot;code_structure&quot;,
  &quot;node_types&quot;: {
    &quot;package&quot;: { &quot;relationships&quot;: { &quot;has&quot;: { &quot;inverse&quot;: &quot;in&quot;, &quot;targets&quot;: [&quot;package&quot;, &quot;module&quot;] } } },
    &quot;module&quot;:  { &quot;relationships&quot;: { &quot;defines&quot;: { &quot;inverse&quot;: &quot;defined_in&quot;, &quot;targets&quot;: [&quot;class&quot;, &quot;function&quot;] },
                                    &quot;imports&quot;: { &quot;inverse&quot;: &quot;imported_by&quot;, &quot;targets&quot;: [&quot;module&quot;] } } },
    &quot;class&quot;:   { &quot;relationships&quot;: { &quot;has&quot;: { &quot;inverse&quot;: &quot;in&quot;, &quot;targets&quot;: [&quot;method&quot;] },
                                    &quot;inherits_from&quot;: { &quot;inverse&quot;: &quot;inherited_by&quot;, &quot;targets&quot;: [&quot;class&quot;] } } },
    &quot;method&quot;:  { &quot;relationships&quot;: { &quot;calls&quot;: { &quot;inverse&quot;: &quot;called_by&quot;, &quot;targets&quot;: [&quot;method&quot;, &quot;function&quot;] } } },
    &quot;function&quot;: { &quot;relationships&quot;: { &quot;calls&quot;: { &quot;inverse&quot;: &quot;called_by&quot;, &quot;targets&quot;: [&quot;method&quot;, &quot;function&quot;] } } }
  }
}
</code></pre>
<h4 id="taxonomy__code_elementsjson">taxonomy__code_elements.json<a class="headerlink" href="#taxonomy__code_elementsjson" title="Permanent link">&para;</a></h4>
<pre><code>code_element (root)
├── container
│   └── (package, module)
└── code_unit
    └── (class, method, function)
</code></pre>
<h4 id="rules__pythonjson">rules__python.json<a class="headerlink" href="#rules__pythonjson" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Transitivity</strong>: <code>class --inherits_from--&gt; class</code>, <code>package --has--&gt; package</code></li>
<li><strong>Cardinality</strong>: method in exactly 1 class, function defined_in exactly 1 module</li>
</ul>
<hr />
<h2 id="part-2-test-coverage">Part 2: Test Coverage<a class="headerlink" href="#part-2-test-coverage" title="Permanent link">&para;</a></h2>
<h3 id="21-test-file-structure">2.1 Test File Structure<a class="headerlink" href="#21-test-file-structure" title="Permanent link">&para;</a></h3>
<pre><code>tests/unit/
├── helpers/
│   ├── semantic_graphs/
│   │   ├── ontology/
│   │   │   ├── test_Schema__Ontology.py         # 15 tests
│   │   │   └── test_Ontology__Registry.py       # 10 tests
│   │   ├── taxonomy/
│   │   │   └── test_Schema__Taxonomy.py         # 18 tests
│   │   ├── rules/
│   │   │   └── test_Schema__Rule_Set.py         # 14 tests
│   │   ├── graph/
│   │   │   ├── test_Schema__Semantic_Graph.py   # 15 tests
│   │   │   └── test_Semantic_Graph__Builder.py  # 12 tests
│   │   └── test_primitives.py                   # 10 tests
│   └── python_call_flow/
│       └── code_structure/
│           └── test_Code_Structure__Analyzer.py # 16 tests
└── type_safe/
    └── primitives/
        └── domains/
            └── python/
                └── test_python_primitives.py    # 12 tests
</code></pre>
<h3 id="22-testing-patterns-applied">2.2 Testing Patterns Applied<a class="headerlink" href="#22-testing-patterns-applied" title="Permanent link">&para;</a></h3>
<p>Following the Type_Safe Testing Guidance:</p>
<ol>
<li><strong>Context Manager Pattern</strong>: All tests use <code>with ClassName() as _:</code></li>
<li><strong>Deterministic IDs</strong>: <code>graph_ids_for_tests()</code> for reproducible test data</li>
<li><strong>setUpClass</strong>: Shared expensive objects (ontologies, taxonomies) created once</li>
<li><strong>No Mocks</strong>: Real implementations throughout</li>
<li><strong>Inline Comments</strong>: Documentation via aligned comments, no docstrings</li>
<li><strong>Method Naming</strong>: <code>test__method__scenario</code> pattern</li>
</ol>
<h3 id="23-key-test-scenarios">2.3 Key Test Scenarios<a class="headerlink" href="#23-key-test-scenarios" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Critical Tests</th>
</tr>
</thead>
<tbody>
<tr>
<td>Schema__Ontology</td>
<td>valid/invalid edge detection, inverse verb lookup, edge enumeration</td>
</tr>
<tr>
<td>Ontology__Registry</td>
<td>JSON parsing, caching, relationship preservation</td>
</tr>
<tr>
<td>Schema__Taxonomy</td>
<td>Hierarchy navigation, ancestor/descendant traversal</td>
</tr>
<tr>
<td>Schema__Rule_Set</td>
<td>Transitivity checking, cardinality lookup</td>
</tr>
<tr>
<td>Schema__Semantic_Graph</td>
<td>Node/edge CRUD, type filtering, neighbor queries</td>
</tr>
<tr>
<td>Semantic_Graph__Builder</td>
<td>Fluent API, ontology validation, invalid edge rejection</td>
</tr>
<tr>
<td>Semantic_Graph__Validator</td>
<td>Node type validation, edge validation, cardinality checking</td>
</tr>
<tr>
<td>Code_Structure__Analyzer</td>
<td>Class/function analysis, inheritance edges, node deduplication</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="part-3-refinement-identified">Part 3: Refinement Identified<a class="headerlink" href="#part-3-refinement-identified" title="Permanent link">&para;</a></h2>
<h3 id="31-the-id-primitive-issue">3.1 The ID Primitive Issue<a class="headerlink" href="#31-the-id-primitive-issue" title="Permanent link">&para;</a></h3>
<p><strong>Problem Discovered During Integration:</strong></p>
<p>The original implementation used <code>Safe_Id</code> as the base class for semantic identifiers:</p>
<pre><code class="language-python">class Node_Type_Id(Safe_Id): pass
class Ontology_Id(Safe_Id): pass
# etc.
</code></pre>
<p><strong>Issue</strong>: <code>Safe_Id</code> auto-generates a random value when <code>value=None</code>:</p>
<pre><code class="language-python">class Safe_Id(Type_Safe__Primitive, str):
    def __new__(cls, value=None, max_length=SAFE_ID__MAX_LENGTH):
        if value is None:
            value = safe_id(random_id_short(prefix='safe-id'))  # &lt;-- Problem!
        sanitized_value = safe_id(value, max_length=max_length)
        return str.__new__(cls, sanitized_value)
</code></pre>
<p><strong>Consequences:</strong>
- Serialization round-trips create new IDs on deserialization
- REST API responses have different IDs than requests
- Empty/optional IDs get unexpected values</p>
<h3 id="32-two-categories-of-ids">3.2 Two Categories of IDs<a class="headerlink" href="#32-two-categories-of-ids" title="Permanent link">&para;</a></h3>
<p>The implementation revealed two distinct ID categories:</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Purpose</th>
<th>Behavior</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Instance IDs</strong></td>
<td>Unique identifiers for graph instances</td>
<td>Auto-generate via <code>Obj_Id()</code>, support deterministic testing</td>
<td><code>Node_Id</code>, <code>Edge_Id</code>, <code>Graph_Id</code></td>
</tr>
<tr>
<td><strong>Semantic IDs</strong></td>
<td>Named/labeled identifiers for types/definitions</td>
<td>Human-readable strings, NEVER auto-generate, allow empty</td>
<td><code>Node_Type_Id</code>, <code>Ontology_Id</code>, <code>Taxonomy_Id</code>, <code>Category_Id</code>, <code>Rule_Set_Id</code></td>
</tr>
</tbody>
</table>
<h3 id="33-proposed-fix-semantic_id-base-class">3.3 Proposed Fix: Semantic_Id Base Class<a class="headerlink" href="#33-proposed-fix-semantic_id-base-class" title="Permanent link">&para;</a></h3>
<p><strong>New Primitive:</strong></p>
<pre><code class="language-python">from osbot_utils.type_safe.primitives.domains.identifiers.Obj_Id import Obj_Id


class Semantic_Id(Obj_Id):                                                           # Base for named semantic identifiers
    def __new__(cls, value=None):                                                    # Allow empty, never auto-generate
        if value is None or value == '':
            return str.__new__(cls, '')
        return super().__new__(cls, value)
</code></pre>
<p><strong>Updated Primitives:</strong></p>
<pre><code class="language-python">class Node_Type_Id(Semantic_Id): pass                                                # e.g., 'class', 'method', 'function'
class Ontology_Id(Semantic_Id): pass                                                 # e.g., 'code_structure'
class Taxonomy_Id(Semantic_Id): pass                                                 # e.g., 'code_elements'
class Category_Id(Semantic_Id): pass                                                 # e.g., 'container', 'code_unit'
class Rule_Set_Id(Semantic_Id): pass                                                 # e.g., 'python_rules'
</code></pre>
<p><strong>Benefits:</strong>
1. Empty values allowed (for optional references)
2. No random ID generation on deserialization
3. Consistent with MGraph node ID model
4. Clear semantic distinction from instance IDs</p>
<h3 id="34-impact-on-tests">3.4 Impact on Tests<a class="headerlink" href="#34-impact-on-tests" title="Permanent link">&para;</a></h3>
<p>The test suite remains valid - it was already using string values for semantic IDs:</p>
<pre><code class="language-python"># These patterns work correctly with Semantic_Id
targets = [Node_Type_Id('class'), Node_Type_Id('function')]
taxonomy_id = Taxonomy_Id('code_elements')
ontology_ref = Ontology_Id('code_structure')
</code></pre>
<p>The empty-value support is tested:</p>
<pre><code class="language-python">def test__init__(self):
    with Schema__Ontology(ontology_id=Ontology_Id('empty')) as _:
        assert str(_.ontology_id) == 'empty'
</code></pre>
<hr />
<h2 id="part-4-architecture-diagram">Part 4: Architecture Diagram<a class="headerlink" href="#part-4-architecture-diagram" title="Permanent link">&para;</a></h2>
<pre><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                           SEMANTIC GRAPHS FRAMEWORK                          │
│                     osbot_utils/helpers/semantic_graphs/                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                           PRIMITIVES                                  │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │ Semantic_Id │  │Node_Type_Id │  │ Ontology_Id │  │ Taxonomy_Id │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌───────────────────────────────┐ │   │
│  │  │ Category_Id │  │ Rule_Set_Id │  │ Safe_Str__Ontology__Verb      │ │   │
│  │  └─────────────┘  └─────────────┘  └───────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                    │                                         │
│                                    ▼                                         │
│  ┌────────────────────┐  ┌────────────────────┐  ┌────────────────────┐     │
│  │      ONTOLOGY      │  │      TAXONOMY      │  │       RULES        │     │
│  │                    │  │                    │  │                    │     │
│  │ Schema__Ontology   │  │ Schema__Taxonomy   │  │ Schema__Rule_Set   │     │
│  │   __Relationship   │  │   __Category       │  │   __Transitivity   │     │
│  │   __Node_Type      │  │                    │  │   __Cardinality    │     │
│  │                    │  │                    │  │                    │     │
│  │ Ontology__Registry │  │ Taxonomy__Registry │  │ Rule__Engine       │     │
│  └────────────────────┘  └────────────────────┘  └────────────────────┘     │
│            │                      │                        │                 │
│            └──────────────────────┼────────────────────────┘                 │
│                                   ▼                                          │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                             GRAPH                                     │   │
│  │                                                                       │   │
│  │  Schema__Semantic_Graph                                               │   │
│  │  ├── nodes: Dict[str, Schema__Semantic_Graph__Node]                   │   │
│  │  ├── edges: List[Schema__Semantic_Graph__Edge]                        │   │
│  │  └── Methods: add_node, get_node, nodes_by_type, neighbors, etc.      │   │
│  │                                                                       │   │
│  │  Semantic_Graph__Builder      Semantic_Graph__Validator               │   │
│  │  └── Fluent construction      └── Ontology + Rules validation         │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          PYTHON CALL FLOW                                    │
│                osbot_utils/helpers/python_call_flow/                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                        CODE STRUCTURE                                 │   │
│  │                                                                       │   │
│  │  Code_Structure__Analyzer                                             │   │
│  │  ├── analyze(target) → Schema__Semantic_Graph                         │   │
│  │  ├── analyze_class/module/function/method                             │   │
│  │  └── Uses: ontology__code_structure.json                              │   │
│  │            taxonomy__code_elements.json                               │   │
│  │            rules__python.json                                         │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                         CALL FLOW (existing)                          │   │
│  │                                                                       │   │
│  │  Call_Flow__Analyzer                                                  │   │
│  │  └── Future: Refactor to use Code Structure graph references          │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<hr />
<h2 id="part-5-file-inventory">Part 5: File Inventory<a class="headerlink" href="#part-5-file-inventory" title="Permanent link">&para;</a></h2>
<h3 id="51-semantic-graphs-framework-33-python-files">5.1 Semantic Graphs Framework (33 Python files)<a class="headerlink" href="#51-semantic-graphs-framework-33-python-files" title="Permanent link">&para;</a></h3>
<pre><code>osbot_utils/helpers/semantic_graphs/
├── __init__.py
├── primitives/
│   ├── __init__.py
│   ├── Ontology_Id.py
│   ├── Taxonomy_Id.py
│   ├── Category_Id.py
│   ├── Node_Type_Id.py
│   ├── Rule_Set_Id.py
│   └── safe_str/
│       ├── __init__.py
│       └── Safe_Str__Ontology__Verb.py
├── ontology/
│   ├── __init__.py
│   ├── Ontology__Registry.py
│   └── schemas/
│       ├── __init__.py
│       ├── Schema__Ontology.py
│       ├── Schema__Ontology__Node_Type.py
│       └── Schema__Ontology__Relationship.py
├── taxonomy/
│   ├── __init__.py
│   ├── Taxonomy__Registry.py
│   └── schemas/
│       ├── __init__.py
│       ├── Schema__Taxonomy.py
│       └── Schema__Taxonomy__Category.py
├── rules/
│   ├── __init__.py
│   ├── Rule__Engine.py
│   └── schemas/
│       ├── __init__.py
│       ├── Schema__Rule_Set.py
│       ├── Schema__Rule__Transitivity.py
│       └── Schema__Rule__Cardinality.py
└── graph/
    ├── __init__.py
    ├── Semantic_Graph__Builder.py
    ├── Semantic_Graph__Validator.py
    └── schemas/
        ├── __init__.py
        ├── Schema__Semantic_Graph.py
        ├── Schema__Semantic_Graph__Node.py
        └── Schema__Semantic_Graph__Edge.py
</code></pre>
<h3 id="52-python-domain-primitives-7-python-files">5.2 Python Domain Primitives (7 Python files)<a class="headerlink" href="#52-python-domain-primitives-7-python-files" title="Permanent link">&para;</a></h3>
<pre><code>osbot_utils/type_safe/primitives/domains/python/
├── __init__.py
└── safe_str/
    ├── __init__.py
    ├── Safe_Str__Python__Class.py
    ├── Safe_Str__Python__Method.py
    ├── Safe_Str__Python__Function.py
    ├── Safe_Str__Python__Package.py
    └── Safe_Str__Python__Qualified_Name.py
</code></pre>
<h3 id="53-code-structure-2-python-files-3-json">5.3 Code Structure (2 Python files + 3 JSON)<a class="headerlink" href="#53-code-structure-2-python-files-3-json" title="Permanent link">&para;</a></h3>
<pre><code>osbot_utils/helpers/python_call_flow/code_structure/
├── __init__.py
├── Code_Structure__Analyzer.py
└── data/
    ├── ontology__code_structure.json
    ├── taxonomy__code_elements.json
    └── rules__python.json
</code></pre>
<h3 id="54-tests-9-test-files">5.4 Tests (9 test files)<a class="headerlink" href="#54-tests-9-test-files" title="Permanent link">&para;</a></h3>
<pre><code>tests/unit/
├── helpers/
│   ├── semantic_graphs/
│   │   ├── test_primitives.py
│   │   ├── ontology/
│   │   │   ├── test_Schema__Ontology.py
│   │   │   └── test_Ontology__Registry.py
│   │   ├── taxonomy/
│   │   │   └── test_Schema__Taxonomy.py
│   │   ├── rules/
│   │   │   └── test_Schema__Rule_Set.py
│   │   └── graph/
│   │       ├── test_Schema__Semantic_Graph.py
│   │       └── test_Semantic_Graph__Builder.py
│   └── python_call_flow/
│       └── code_structure/
│           └── test_Code_Structure__Analyzer.py
└── type_safe/
    └── primitives/
        └── domains/
            └── python/
                └── test_python_primitives.py
</code></pre>
<hr />
<h2 id="part-6-next-steps">Part 6: Next Steps<a class="headerlink" href="#part-6-next-steps" title="Permanent link">&para;</a></h2>
<h3 id="61-immediate-actions-required">6.1 Immediate Actions Required<a class="headerlink" href="#61-immediate-actions-required" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Create <code>Semantic_Id</code> primitive</strong> - New base class for named identifiers</li>
<li><strong>Update ID primitives</strong> - Change base class from <code>Safe_Id</code> to <code>Semantic_Id</code></li>
<li><strong>Run test suite</strong> - Verify all tests pass with updated primitives</li>
</ol>
<h3 id="62-future-enhancements-from-brief-3">6.2 Future Enhancements (from Brief 3)<a class="headerlink" href="#62-future-enhancements-from-brief-3" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Refactor Call Flow</strong> - Update <code>Schema__Call_Flow__Node</code> to use structure references</li>
<li><strong>MGraph Integration</strong> - Convert semantic graphs to MGraph objects</li>
<li><strong>Additional Ontologies</strong> - Consider other domain ontologies beyond code structure</li>
<li><strong>Rule Engine Expansion</strong> - Add rule evaluation during graph construction</li>
</ol>
<h3 id="63-integration-with-existing-code">6.3 Integration with Existing Code<a class="headerlink" href="#63-integration-with-existing-code" title="Permanent link">&para;</a></h3>
<p>The implementation is designed to coexist with the existing Call Flow analyzer:</p>
<pre><code class="language-python"># Current: Call Flow stores redundant module/file info
Schema__Call_Graph__Node:
    module    : Safe_Str__Module
    file_path : Safe_Str__File_Path
    # ... redundant per node

# Future: Call Flow references Code Structure
Schema__Call_Flow__Node:
    structure_ref : Node_Id                      # References Code Structure node
    # ... lightweight behavioral data only
</code></pre>
<hr />
<h2 id="part-7-lessons-learned">Part 7: Lessons Learned<a class="headerlink" href="#part-7-lessons-learned" title="Permanent link">&para;</a></h2>
<h3 id="71-id-primitive-design">7.1 ID Primitive Design<a class="headerlink" href="#71-id-primitive-design" title="Permanent link">&para;</a></h3>
<p>The distinction between "instance IDs" (auto-generated, unique per object) and "semantic IDs" (named labels, human-readable) should be explicit in the type system. This prevents serialization issues and makes the intent clear.</p>
<h3 id="72-json-driven-configuration">7.2 JSON-Driven Configuration<a class="headerlink" href="#72-json-driven-configuration" title="Permanent link">&para;</a></h3>
<p>Defining ontologies, taxonomies, and rules in JSON files provides:
- Easy modification without code changes
- Clear separation of structure from behavior
- Potential for runtime loading of different domain ontologies</p>
<h3 id="73-bidirectional-relationships">7.3 Bidirectional Relationships<a class="headerlink" href="#73-bidirectional-relationships" title="Permanent link">&para;</a></h3>
<p>Storing both forward and inverse verb names on relationships enables:
- Graph queries in both directions
- Meaningful edge names (e.g., "class_has_method" vs "method_in_class")
- Natural language-like relationship descriptions</p>
<h3 id="74-validation-layering">7.4 Validation Layering<a class="headerlink" href="#74-validation-layering" title="Permanent link">&para;</a></h3>
<p>Three levels of validation work together:
1. <strong>Type-level</strong>: Safe primitives enforce format constraints
2. <strong>Ontology-level</strong>: Valid edges checked against node type definitions
3. <strong>Rule-level</strong>: Cardinality and transitivity constraints applied</p>
<hr />
<h2 id="appendix-key-code-patterns">Appendix: Key Code Patterns<a class="headerlink" href="#appendix-key-code-patterns" title="Permanent link">&para;</a></h2>
<h3 id="a1-fluent-graph-construction">A.1 Fluent Graph Construction<a class="headerlink" href="#a1-fluent-graph-construction" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">with Semantic_Graph__Builder() as builder:
    builder.create('code_structure').with_ontology(ontology)

    class_id  = builder.add_node('class', 'MyClass', line_number=10)
    method_id = builder.add_node('method', 'my_method', line_number=15)

    builder.add_edge(class_id, 'has', method_id)

    graph = builder.build()
</code></pre>
<h3 id="a2-graph-querying">A.2 Graph Querying<a class="headerlink" href="#a2-graph-querying" title="Permanent link">&para;</a></h3>
<pre><code class="language-python"># Find all classes
classes = graph.nodes_by_type('class')

# Find methods of a specific class
method_ids = graph.neighbors(str(class_id), 'has')

# Find what contains a method (reverse lookup)
container_ids = graph.reverse_neighbors(str(method_id), 'has')

# Get all inheritance edges
inheritance = graph.edges_by_verb('inherits_from')
</code></pre>
<h3 id="a3-ontology-validation">A.3 Ontology Validation<a class="headerlink" href="#a3-ontology-validation" title="Permanent link">&para;</a></h3>
<pre><code class="language-python"># Check if edge would be valid
if ontology.valid_edge('class', 'has', 'method'):
    # Add edge

# Get inverse for bidirectional reference
inverse = ontology.get_inverse_verb('class', 'has')  # Returns 'in'
</code></pre>
<hr />
<p><strong>Document Version</strong>: 1.0
<strong>Implementation Version</strong>: v3.64.1
<strong>Companion Documents</strong>: 
- v3_64_0__brief_3__semantic_graphs__and__code_structure__implementation_brief.md
- v3_1_1__for_llms__type_safe__testing_guidance.md</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
